<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>消息通知</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/member.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.idTabs.min.js"></script>
</head>
<body>
	<div class="place">
    <span>位置：</span>
    <ul class="placeul">
    <li><a href="main.php">首页</a></li>
    <li><a href="#">消息通知</a></li>
    </ul>
    </div>    
    <div class="formbody">   
    <div id="usual1" class="usual">    
		<div class="itab">
		<ul> 
		<li><a href="#tab1" class="selected">群发信息</a></li> 
		<li><a href="#tab2">单发信息</a></li> 
		<li><a href="#tab3">群发记录</a></li> 
		<li><a href="#tab4">单发记录</a></li> 
		</ul>
		</div> 
		<div id="tab1" class="tabson">			
			<div class="formbody">			
			<div class="formtitle"><span>群发信息</span></div>
			<form action="" method="post">
			<ul class="forminfo formclear">
			<li>会员组：<select name="groupid">
				<?php 
				 foreach($res as $val){
				   echo "<option value=\"{$val['groupid']}\">{$val['name']}</option>";
				 }
				?>
			  </select>
			</li>
			<li>标　题：<input name="subject" type="text" class="input_text" required/><i id="tishi1">请输入标题</i></li>
			<li>内　容：<textarea name="content" required class="textarea" style="height:120px;width:50%"></textarea></li>
			<li><input name="submit1" type="submit" class="dosubmit" value="确定"/></li>
			</ul>
			</form>			
			</div>		
		</div>    
		<div id="tab2" class="tabson">
			<div class="formbody">
			
			<div class="formtitle"><span>单发信息</span></div>
			<form action="" method="post" onSubmit="return check2()">
			<ul class="forminfo formclear">
			<li>收件人：<input type="text" name="send_to" id="username" class="input_text" required><i id="tishi2">请输收件人</i></li>
			<li>标　题：<input name="subject" type="text" class="input_text" required/><i id="tishi3">请输入标题</i></li>
			<li>内　容：<textarea name="content" required class="textarea" style="height:120px;width:50%"></textarea></li>
			<li><input name="submit2" type="submit" class="dosubmit" value="确定"/></li>
			</ul>
			</form>			
			</div>		
		</div>  		
		<div id="tab3" class="tabson">
			<div class="formbody">			
			<div class="formtitle"><span>群发记录 [最近20条]</span></div>
			<form action="" method="post">
				<table class="tablelist">
					<thead>
					<tr>
					<th width='35'><input type="checkbox"   onclick="cz(this)"/></th>
					<th>标题</th>
					<th>内容</th>
					<th width='135'>发送时间</th>
					<th width='105'>用户组</th>
					</tr>
					</thead>
					<tbody>
					<?php foreach($data as $val){ ?>			
					<tr>
					<td><input name="fx[]" type="checkbox" value="<?php echo $val['id']?>" /></td>
					<td><?php echo $val['subject']?></td>
					<td><?php echo $val['content']?></td>
					<td><?php echo date("Y-m-d H:i:s",$val['inputtime']) ?></td>
					<td><?php echo $res[$val['groupid']-1]['name']?></td>
					</tr> 
					<?php }	?>			
					<tr class="tablast">
					 <td></td><td colspan="4"><input type="submit"  value="批量删除" onclick="return confirm('你确定要删除所选信息吗？')" name="submit3"></td>
					</tr>
					</tbody>
				</table>
			</form>				
			</div>		
		</div>  
		<div id="tab4" class="tabson">
			<div class="formbody">			
			<div class="formtitle"><span>单发记录 [最近20条]</span></div>
			<form action="" method="post">
				<table class="tablelist">
					<thead>
					<tr>
					<th width='35'><input type="checkbox"   onclick="cz(this)"/></th>
					<th>标题</th>
					<th>内容</th>
					<th width='135'>发送时间</th>
					<th width='105'>收件人</th>
					<th width='95'>收件人已读</th>
					</tr>
					</thead>
					<tbody>
					<?php foreach($data2 as $val){ ?>			
					<tr>
					<td><input name="fx[]" type="checkbox" value="<?php echo $val['messageid']?>" /></td>
					<td><?php echo $val['subject']?></td>
					<td><?php echo $val['content']?></td>
					<td><?php echo date("Y-m-d H:i:s",$val['message_time']) ?></td>
					<td><?php echo $val['send_to'] ?></td>
					<td><?php echo $val['isread']=='0' ? '<span style="color:red">未读</span>' : '已读'; ?></td>
					</tr> 
					<?php }	?>			
					<tr class="tablast">
					 <td></td><td colspan="5"><input type="submit"  value="批量删除" onclick="return confirm('你确定要删除所选信息吗？')" name="submit4"></td>
					</tr>
					</tbody>
				</table>
			</form>				
			</div>		
		</div> 		
	</div> 
	  <script type="text/javascript">
	    $("#usual1 ul").idTabs(); 
        $('.tablelist tbody tr:odd').addClass('odd');
		
		var fx=document.getElementsByName("fx[]");
		function cz(obj){
		for(var i=0;i<fx.length;i++){
			  fx[i].checked=obj.checked;
			}
		}		
		
		$(function(){
		   $("#username").blur(function(){
			  checkname();
		   });	   
		})	
			
		function checkname(){
			 if($("#username").val() != ''){
			  $.ajax({   
				type: "post",   
				url: "<?php echo $webinfo['wroot']?>member/ajax/checkname.php",   
				dataType: "html",
				async:false,		//同步请求,可以根据实际情况关闭
				data: "username="+$('#username').val(), 
				beforeSend: function(){
					 $('#username').next().html('<img src="./images/loading2.gif">');
					 $("#dosubmit").attr({ disabled: "disabled" });  // 禁用按钮防止重复提交
				},				
				success: function(msg){  
				 if(msg == '-1'){
					  $('#username').next().html('<img src="./images/ok.gif">');
					  $('#username').removeClass('err'); 
					  $("#dosubmit").removeAttr("disabled");					  
				 }else if(msg == '1'){
					  $('#username').next().html('<img src="./images/error.gif">用户名不存在！');
					  $('#username').addClass('err');	
				 }else if(msg == '-2'){
					  $('#username').next().html('<img src="./images/error.gif">用户名格式不正确！');
					 $('#username').addClass('err');
				 }else{
					  $('#username').next().html('<img src="./images/error.gif">未知错误！');
					  $('#username').addClass('err');
				 }				 
				} 
			  });
			 }else{
			  $('#username').next().html('<img src="./images/error.gif">用户名不能为空！');
			  $('#username').addClass('err');
			 }		   
		}
		function check2(){
			checkname();
			if($("#username").hasClass("err")) return false;
			return true;			
		}	
	  </script> 
    </div>
</body>
</html>
