<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>会员管理</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/select.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="../common/js/laydate.js"></script>
</head>
<body>
	<div class="place">
    <span>位置：</span>
    <ul class="placeul">
    <li><a href="main.php">首页</a></li>
    <li><a href="#">会员管理</a></li>
	</ul>
	<a href="member_add.php" class="add_link">[添加会员]</a>   
    </div>    
    <div class="rightinfo">
	<div class="topstyle">
		<form action="" method="get">
		<ul class="seachform">
		<li><label>注册时间</label>  
		<div class="vocation">
		<input class="inline laydate-icon" <?php if(isset($_GET['start']) && $_GET["start"] != '') echo 'value="'.$_GET['start'].'"'; ?> type="text" id="start" name="start"> -
		<input class="inline laydate-icon" value="<?php if(isset($_GET['end']) &&  $_GET["end"] != '') echo $_GET['end']; else echo date('Y-m-d H:i:s'); ?>" type="text" id="end" name="end">
		</div>
		</li> 	
		<li>  
		<select class="select3" name="status">
			<option value="99" <?php if(isset($_GET['status']) && $_GET['status']=='99'){?> selected <?php }?>>状态</option>
			<option value="1" <?php if(isset($_GET['status']) && $_GET['status']=='1'){?> selected <?php }?>>正常</option>
			<option value="2" <?php if(isset($_GET['status']) && $_GET['status']=='2'){?> selected <?php }?>>锁定</option>
		</select>
		</li> 
		<li>  
		<select class="select3" name="groupid">
		<option <?php if(isset($_GET['groupid']) && $_GET['groupid']=='0'){?> selected <?php }?> value="0">会员组</option>
		<?php 
		 foreach($groupdata as $val){
		   $str = isset($_GET['groupid']) && $_GET["groupid"] == $val['groupid'] ? 'selected' : '';
		   echo '<option value="'.$val['groupid'].'" '.$str.'>'.$val['name'].'</option>';
		 }
		?>
		</select>
		</li>	
		<li>
		<div class="vocation">
		<select class="select3" name="searkey">
		<option <?php if(isset($_GET['searkey']) && $_GET['searkey']=='username'){?> selected <?php }?> value="username">用户名</option>
		<option <?php if(isset($_GET['searkey']) && $_GET['searkey']=='userid'){?> selected <?php }?> value="userid">用户ID</option>	
		<option <?php if(isset($_GET['searkey']) && $_GET['searkey']=='email'){?> selected <?php }?> value="email">邮箱</option>
		<option <?php if(isset($_GET['searkey']) && $_GET['searkey']=='nickname'){?> selected <?php }?> value="nickname">昵称</option>	
		</select>
		</div>
		</li>
		<li><input name="searinfo" type="text" class="scinput" value="<?php if(isset($_GET["searinfo"])) echo $_GET["searinfo"]; ?>"/></li>	
		<li><label>&nbsp;</label><input type="submit" name="search" class="scbtn" value="搜索"/></li>   
		</ul>
		</form>	
	</div>
    <form method="post" action="" onsubmit="return check_form()">
		<table class="tablelist">
			<thead>
			<tr>
			<th width='35'><input type="checkbox"   onclick="cz(this)"/></th>
			<th width='60'>用户ID</th>
			<th>用户名</th>
			<th>昵称</th>
			<th>邮箱</th>
			<th width='85'>用户组</th>
			<th width='110'>注册IP</th>
			<th width='135'>最后登录时间</th>
			<th width='70'>登录次数</th>
			<th width='55'>积分</th>
			<th width='75'>操作</th>
			</tr>
			</thead>
			<tbody>
			<?php foreach($res as $val){ ?>			
			<tr>
			<td><input name="fx[]" type="checkbox" value="<?php echo $val['userid']?>" /></td>
			<td><?php echo $val['userid']?></td>
			<td><a href="member_edit.php?id=<?php echo $val['userid']?>"><?php if($val['status'] == 2) echo '<img src="images/icon_padlock.gif" title="用户已锁定">';echo $val['username'];?></a></td>
			<td><?php echo $val['nickname']?></td>
			<td><?php echo $val['email_status'] ? $val['email'].' <span class="green" title="已验证">[验]</span>' : $val['email'];?></td>
			<td><?php 
			  $result = $member_group->field('name')->where(array('groupid'=>$val['groupid']))->find();
			  echo $result['name'];			
			?></td>
			<td><?php echo $val['regip']?></td>
			<td><?php echo date("Y-m-d H:i:s",$val['lastdate'])?></td>
			<td><?php echo $val['loginnum']?></td>
			<td><?php echo $val['point']?></td>
			<td><a href="member_edit.php?id=<?php echo $val['userid']?>" class="tablelink">修改</a>     <a href="member_show.php?id=<?php echo $val['userid']?>" class="tablelink"> 查看</a></td>
			</tr> 
			<?php }	?>			
		   	<tr class="tablast">
			 <td></td><td colspan="10"><input type="submit"  value="删除" onclick="return confirm('你确定要删除所选信息吗？')" name="pldel_sub">
			 <input type="submit"  value="锁定" name="lock"><input type="submit"  value="解锁" name="unlock"></td>
			</tr>
			</tbody>
		</table>
	</form>
		<script>
		var fx=document.getElementsByName("fx[]");
		function cz(obj){
		    for(var i=0;i<fx.length;i++){
			  fx[i].checked=obj.checked;
			}
		}
		
		function check_form(){
		   if ($("input[name='fx[]']:checked").length<1){
		       alert('请选择会员！');
		       return false;
		   }
		   return true;
		}
		
		var start = {
			elem: '#start',
			format: 'YYYY-MM-DD hh:mm:ss',
			min: '1999-01-01', //设定最小日期
			max: '2099-01-01', //最大日期
			istime: true,
			istoday: false,
			choose: function(datas){
				 end.min = datas; //开始日选好后，重置结束日的最小日期
				 end.start = datas //将结束日的初始值设定为开始日
			}
		};

		var end = {
			elem: '#end',
			format: 'YYYY-MM-DD hh:mm:ss',
			min: '1999-01-01',
			max: '2099-01-01',
			istime: true,
			istoday: false,
			choose: function(datas){
				start.max = datas; //结束日选好后，充值开始日的最大日期
			}
		};
		laydate(start);
		laydate(end);		
		</script> 			   
		<div class="pagin">
			<div class="message">共<i class="blue"><?php echo $total?></i>条记录，共<i class="blue"><?php echo $page->total()?></i>页，当前显示第&nbsp;<i class="blue"><?php echo $page->getCpage()?>&nbsp;</i>页</div>
			<div class="paginList">
				<?php echo $page->showFull(); ?>
			</div>
		</div>
    </div>
</body>
</html>
