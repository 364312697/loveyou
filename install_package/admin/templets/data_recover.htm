<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>数据恢复</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script language = "JavaScript" src="js/jquery.js"></script>
</head>
<body class="f8"> 
	<div class="place">
    <span>位置：</span>
    <ul class="placeul">
    <li><a href="main.php">首页</a></li>
    <li><a href="#">数据恢复</a></li>
    </ul>
    </div>
	<div class="formbody datashow"> 
     <?php 
		if(isset($_GET['backname'])){
			echo '<div id="msg_info">        	
					<div id="msgtit">提示信息</div>
					<div id="msgbody">					 
					<div id="info">';
					$db->restore ($_GET['backname']);
			echo    '</div>
					</div>
				 </div>';		
			exit;		
		}	 
		$base_dir = './data/';
		$fso=opendir($base_dir);
		echo '<table border="1" class="rec_tab">';
		echo '<tr><th colspan="5">已备份的SQL文件</th></tr>';
		echo '<tr bgcolor="#f0f5f7" align="center"><td>序号</td><td>文件名</td><td>文件大小</td><td>备份时间</td><td>操作</td></tr>';
		$i=0;
		while($flist=readdir($fso)){
			 if(substr($flist,-4) != '.sql') continue;
			 $i++;
			 $file=$base_dir.$flist;
			  echo '<tr align="center">';
			  echo '<td>'.$i.'</td>';
			  echo '<td align="left">'.$flist.'</td>';
			  echo '<td>'.sizecount(filesize($file)).'</td>';
			  echo '<td>'.date('Y-m-d H:i:s', filectime($file)).'</td>';
			  echo '<td><a href="?filename='.$file.'"  onclick="return confirm(\'你确定要删除吗？\')">删除</a> | <a href="?backname='.$file.'"  onclick="return confirm(\'您的操作将会还原以前数据，你确定要继续吗？\')">导入</a> | <a href="?down='.$file.'">下载</a></td>';
			  echo '</tr>';
		}
		echo '<tr bgcolor="#f0f5f7" align="center"><td colspan="5"> <strong>Tips:文件名称_v前相同的为同一次备份的文件,导入时需点导入第一个的文件,程序将自动导入剩余文件</strong></td></tr></table>';
		closedir($fso);
		?>
    </div>
</body>
</html>