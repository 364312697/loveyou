<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>添加字段</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/member.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>
</head>
<body>
	<div class="place">
    <span>位置：</span>
    <ul class="placeul">
    <li><a href="main.php">首页</a></li>
	<li><a href="manage_diyform.php">自定义表单</a></li>
	<li><a href="manage_diy_field.php?id=<?php echo $modelid?>">字段管理</a></li>
	<li><a href="#">添加字段</a></li>
	</ul>
    </div>    
    <div class="rightinfo">
	  <fieldset>
		<legend>基本信息</legend>
		    <form action="" method="post" onsubmit="return check_all()">
			<table width="100%" class="table_form">
				<tr>
					<td>表单名称:</td> 
					<td><?php echo $model_data['name'].'<span class="tips"> ['.$model_data['tablename'].']</span>';?></td>
				</tr>			
				<tr>
					<td width="180">字段类型</td> 
					<td>
					<select name="formtype" id="formtype" onchange="javascript:field_setting(this.value);">
					<option value='0' selected>请选择字段类型</option>
					<option value="input" >单行文本</option>
					<option value="textarea" >多行文本</option>
					<option value="number" >整数类型</option>
					<option value="date" >时间类型</option>
					<option value="file" >图片上传</option>					
					<option value="select" >option下拉框</option>
					<option value="radio" >radio选项卡</option>
					<option value="checkbox" >checkbox多选框</option>
					</select>
                    <span class="red">*</span></td>
				</tr>
				<tr>
					<td>字段名</td> 
					<td><input type="text" name="field" value="" class="input_text" id="field" onblur="check_field()"><span class="red">*</span><span class="tips">例如：name</span></td>
				</tr>
				<tr>
					<td>字段别名</td> 
					<td><input type="text" name="name" value="" class="input_text" id="name" onblur="check_name()"><span class="red">*</span><span class="tips">例如：姓名</span></td>
				</tr>				
				<tr>
					<td>字段提示</td> 
					<td><input type="text" name="tips"  class="input_text" style="width:350px;"><span class="red"></span><span class="tips">显示在字段别名下方作为表单输入提示</span></td>
				</tr>
				<tr style="display:none"  id="options">
					<td>选项列表</td> 
					<td><textarea style="height:100px;width:400px;margin:5px 0;" name="setting[options]"></textarea><span class="red">*</span><span class="tips">用“,”分开，如“男,女,人妖”</span></td>
				</tr>				
				<tr>
					<td>默认值</td> 
					<td><input class="input_text" type="text" value="" name="defaultvalue"></td>
				</tr>				
				<tr>
					<td>字符长度取值范围</td> 
					<td>最小值：<input class="input_text w60" type="text" value="0" name="minlength">
                        最大值：<input class="input_text w60" type="text" value="100" name="maxlength"></td>
				</tr>	
				<tr>
					<td>数据校验未通过的提示信息</td> 
					<td><input type="text" name="errortips" value="" class="input_text" style="width:350px;"></td>
				</tr>			
				<tr>
					<td>值唯一</td> 
					<td>
					 <label><input type="radio" name="isunique" value="1"> 是</label>
					 <label><input type="radio" name="isunique" value="0" checked> 否</label>
					</td>
				</tr>
				<tr>
					<td>禁用</td> 
					<td>
					 <label><input type="radio" name="disabled" value="1"> 是</label>
					 <label><input type="radio" name="disabled" value="0" checked> 否</label>
					</td>
				</tr>				
                <tr>
					<td></td>
					<td>
					<input type="submit" name="dosubmit" id="dosubmit" class="dosubmit" value="提交">
					</td>
				</tr>				
			</table>
            </form>			
	  </fieldset>
    </div>

    <script type="text/javascript">
	
	function field_setting(fieldtype) {
	    if(fieldtype=='select' || fieldtype=='radio' || fieldtype=='checkbox') {
			$('#options').css('display','');
		}else{
			$('#options').css('display','none');
		}   
	}

	function check_name(){ 
       var res = false;	
		if($("input[name='name']").val()==''){
		   $("#name").addClass("err");
		   $('#name').next().html('<img src="images/error.gif">字段别名不能为空！');
		   return false;
		}else{
		   $("#name").removeClass("err");
		   $('#name').next().html('<img src="images/ok.gif">');
		   res = true;
		}
        return res;		
	}
	
	function check_field(){ 
       var res = false;	
       var reg = /^[A-Za-z]+$/;	
       if(!reg.test($("input[name='field']").val())){
			   $("#field").addClass("err");
			   $('#field').next().html('<img src="images/error.gif">字段名不正确！');
			   return false;
		}else{
			   $("#field").removeClass("err");
			   $('#field').next().html('<img src="images/ok.gif">');
		}
		
		$.ajax({   
		type: "post",   
		url: 'libs/ajax.class.php?a=check_field',   
		dataType: "html",
		async:false,
		data: "field="+$('#field').val()+"&tablename=<?php echo $model_data['tablename'];?>",   
		success: function(msg){
		if(msg){
			if(msg==0){
				$('#field').addClass('err');
				$('#field').next().html('<img src="images/error.gif">字段名已经存在！');
			}else if(msg==1){
				$('#field').removeClass('err');
				$('#field').next().html('<img src="images/ok.gif">');
				res = true;	
			}else{
				alert('Ajax通信失败！');
			}
		}  
		}  
		});
        return res;		
	}
	
	function check_all(){
		
	    if($("select[name='formtype']").val()=='0'){
		   $("#formtype").addClass("err");
		   $('#formtype').next().html('<img src="images/error.gif">请选择字段类型！');
		   return false;
		}else{
		   $("#formtype").removeClass("err");
		   $('#formtype').next().html('<img src="images/ok.gif">');
		}
		
	    if(!check_field() || !check_name()){
		    return false;
		}

	    if(isNaN($("input[name='minlength']").val()) || isNaN($("input[name='maxlength']").val())){
		    alert('字符长度取值范围 只能为数字类型！');
		    return false;
		}		
        return true;			
	}
	</script>		
</body>
</html>
